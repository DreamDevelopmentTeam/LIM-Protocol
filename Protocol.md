# LIM通讯协议

> LAN Instant Messaging Protocol

此版本的LIM使用UDP广播进行通信。

各节点之间通过发送**二进制的格式化JSON字段**进行数据教会。

---

## 端口规范

此版本统一接口为**65000**（发送/接收数据均使用此端口）。

端口绑定案例：("0.0.0.0", 65000)

| 参数 | 值 |
| --- | --- |
| 端口 | 65000/UDP |
| 方式 | 广播/去中心化 |
| 验证 | 无 |
| 跨网 | 不支持(仅相同网段) |

--- 

## 网络消息格式

一般地，正常的通信信息格式如下：

```json
{
  "nid" : 0,
  "type": 0,
  "name": "system",
  "msg": "hello"
}
```

| 字段 | 作用 |
| --- | --- |
| nid | 网络ID（Network ID） |
| type | 消息类型 |
| name | 用户名称/操作名称 |
| msg | 消息数据/操作参数 |


在发送消息数据时，先将消息数据转换为**格式化的JSON字符串**，然后使用本协议规定的编码格式编码为**二进制字节集**，并通过网络发送。

与之对应的，如果节点在接收数据报的时候无法通过反向操作还原原始数据（或在还原过程中发生异常），则丢弃该数据报。

---

## 网络ID与聊天隔离

网络ID（Network ID）的作用是在同一局域网分割不同的聊天区域。

节点收到数据包时应首先校验网络ID，并丢弃与自身网络ID不符的数据包。

网络ID规范：

1. 只能由数字构成
2. 网络ID应为大于0的整数
3. 网络ID默认为0


---

## 用户与操作名称

当节点收到类型非普通消息的数据报文时，应当执行对应的操作。

| 字段 | 作用 |
| --- | --- |
| type < 0 | 无效操作/未知操作 |
| type = 0 | 普通消息 |
| type = 1 | 客户端发现协议FCP（Find Client Protocol） |

---

---

## 预览/待定功能

预览或待定的功能，可能在将来提供支持或作废。

**(待定)** 特殊消息列表：

| 消息 | 作用 |
| --- | --- |
| 暂无 | 暂无 |









