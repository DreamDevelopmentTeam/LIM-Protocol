# TLIM通讯协议

> **TCP** LAN Instant Messaging Protocol

此版本的TLIM使用UDP广播进行服务端发现，以稳定可靠的TCP进行数据传输。

客户端和服务器之间通过发送**二进制的格式化JSON字段**进行数据交换。

---

## 端口规范

规定此版本**服务端发现协议**端口为**65000/UDP**（仅客户端查找服务端使用）。

建议此版本**服务端**端口为**65000/TCP**（数据交换使用）。

服务端端口绑定案例：("0.0.0.0", 65000)

**服务端可使用SO_REUSEADDR（Socket属性）实现多个服务端同时绑定65000/UDP端口运行服务端发现服务！**

| 参数 | 值 |
| --- | --- |
| 端口 | 65000/TCP+UDP |
| 方式 | C->S/中心化 |
| 验证 | ID/密码 |
| 跨网 | 支持（指定服务端地址） |

--- 

## 网络消息格式

一般地，正常的通信信息格式如下：

```json
{
  "type" : 0,
  "data": {}
}
```

| 字段 | 作用 |
| --- | --- |
| type | 消息类型 |
| data | 消息数据 |

**消息编码格式：UTF-8**


在双方发送消息数据时，先将消息数据转换为**格式化的JSON字符串**，然后使用本协议规定的编码格式编码为**二进制字节集**，并通过网络发送。

与之对应的，如果某一方在接收数据报的时候无法通过反向操作还原原始数据（或在还原过程中发生异常），则丢弃该数据。

> 为了确保通信安全性，规定客户端与服务端进行通信之前需要先进行**公钥交换**和**加密通信测试**，并**在后续的通信中使用RSA加密原始数据**并发送加密后的密文。
> 如果**加密通信测试未通过**，则双方断开各自的连接。
> 如果**启用加密但收到了无法成功解密的数据包**，则将该数据包进行丢弃。


**加密算法规定：RSA**

---

## 聊天分离隔离

适用于LIM协议的网络ID（Network ID）不再适用于TLIM协议。

在TLIM协议中，存在以下几类聊天消息：

| 模式名称 | 模式ID | 描述 |
| --- | --- | --- |
| 全体消息 | 0 | 所有加入此服务器的人均可接收到的消息 |
| 私聊消息 | 1 | 某人发送给某人的消息，仅接收方能收到的消息 |
| 群聊消息 | 2 | 仅加入了某群聊的人能收到的消息 |


---


## 用户名命名规范

用户名不能为空，不能仅包含空格，不允许包含制表符/换行符，不允许包含有特殊意义的英文符号。

**规定以下字符串（不区分大小写）不能被用于用户名（系统预留）：**
1. admin
2. system
6. core
7. console
8. protocol


**规定包含以下字符串（不区分大小写）的字符串不能被用于用户名（敏感词）：**
1. **刘金玉**
2. **刘国强**
3. **林爽爽**
4. **王可心**

TLIM服务端包含一份敏感词列表，除上述内置敏感词之外，还应支持手动添加/修改敏感词列表。

TLIM服务端应拒绝用户名中包含敏感词的用户的注册及其他相关的操作请求。

---

---

## 相关协议

[服务端发现协议（FSP）](Protocol/FindServerProtocol.MD)

[消息控制协议（MSCP）](Protocol/MessageConsoleProtocol.MD)

---

---

## 预览/待定功能

预览或待定的功能，可能在将来提供支持或作废。


---

## Todo List

可能会在将来添加支持或预览/待定的功能，可能在将来提供完整的支持或作废。

**(待定)** TodoList：

| 功能 | 作用 | 状态 |
| --- | --- | --- |









